# 現在の課題

## 精度状況

### v7.1 (トライグラムLM + 工学・ビジネス語彙拡張)

| テスト条件 | v6 | v7 | v7.1 (現在) |
|---|---|---|---|
| 学習データ（873発話、VOICEVOX 18話者） | 820/873 (93.9%) | 818/873 (93.6%) | 809/873 (92.7%) |
| コーパス内文 × VOICEPEAK neutral | 10/10 (100%) | — | — |
| コーパス内文 × VOICEPEAK 感情50% | 9/10 (90%) | — | — |
| **コーパス外文 × VOICEPEAK neutral** | **4/10 (40%)** | **8/10 (80%)** | **8/10 (80%)** |
| コーパス内文 × VOICEPEAK 感情100% | 2/10 (20%) | — | — |

### v7.1 で拡張した内容

- **コーパス**: 6,637文 → 11,059文 (+66%)
- **語彙**: 184語 → 301語 (+63%)
- **LM**: ユニグラム612→682、バイグラム2,429→3,074、トライグラム8,844→12,777
- **辞書**: 724語 → 900語

#### 追加カテゴリ

| ドメイン | カテゴリ | 語数 | 例 |
|---|---|---|---|
| 工学 | subjects | 5 | 数学, 物理, 化学, 英語, 情報 |
| 工学 | academicThings | 12 | レポート, 論文, 課題, データ, グラフ... |
| 工学 | engineeringThings | 13 | 回路, 基板, ロボット, センサー, モーター... |
| 工学 | equipment | 5 | プリンター, モニター, キーボード, マウス, 黒板 |
| 工学 | academicPeople | 5 | 教授, 先輩, 後輩, 学生, 院生 |
| 工学 | suruNouns | 15 | 勉強, 研究, 実験, 計算, 設計... |
| 工学 | verbAcademic | 9 | 解く, 調べる, 組み立てる, 測る... |
| ビジネス | businessThings | 13 | 資料, 書類, 契約, メール, プロジェクト... |
| ビジネス | businessPeople | 7 | 上司, 部下, 同僚, 社長, 課長, 部長... |
| ビジネス | businessSuru | 19 | 確認, 準備, 報告, 連絡, 相談, 承認... |
| ビジネス | workSuru | 7 | 出勤, 退勤, 出張, 残業, 休憩... |

### コーパス拡張時の制約（学習済みルール）

語彙追加時に偽マッチを回避するため、以下の制約を守る必要がある:

1. **「で」+PLACE展開は厳禁** — 一般場所（窓, 部屋等）と専門語の組み合わせで偽トライグラムが発生する（例: 「窓 で 回路」）
2. **「は」+ADJテンプレートは既存カテゴリ（NATURE/THING/PLACE）のみ** — 追加すると助詞「は」の確率が上がり過剰挿入を招く
3. **既存動詞リストとの重複を避ける** — 頻度が倍増して偽マッチの原因になる
4. **一般文と音響的に混同しやすい語は除外** — パソコン, 動かす, 壊れる, スイッチ等

### v7 で解決した失敗例（維持中）

| 文 | v6 結果 | v7/v7.1 結果 |
|---|---|---|
| 朝から雨が降る | 朝にが降る | **朝から雨が降る** ✓ |
| 友達と映画を見る | 友達と映画を切る | **友達と映画を見る** ✓ |
| 山まで歩く | 山をまで歩く | **山まで歩く** ✓ |
| 駅から電車に乗る | 駅まで電車に乗る | **駅から電車に乗る** ✓ |
| 部屋で本を読む | — (v6は正解) | **部屋で本を読む** ✓ |

## 残存課題

### 1. 音響的に類似した単語の弁別

AMレベルでの混同が残る。LMで補正しきれないケース。

- 「魚と野菜を買う」→「魚を直す」（sakana-to の音響が不安定）
- 「猫が窓で寝る」→「猫が窓で帰る」（neru / kaeru の混同）

### 2. 感情・発話スタイル変動への音響モデル頑健性

感情パラメーター100%で2/10まで劣化。MFCC特徴量ベースのHMMはピッチ変動・話速変化・声質変化に弱い。AM学習データはVOICEVOXの平坦な合成音声のみ。

### 3. 学習データの話者・音源多様性の不足

全学習データがVOICEVOX合成音声のみ。話者正規化（VTLN等）やデータ拡張（速度変換・ピッチシフト・ノイズ付加）も未実装。

### 4. 語彙拡張と精度のトレードオフ

語彙を増やすほど偽マッチ経路が増える。学習データ精度が93.6%→92.7%に微小回帰。テンプレート設計の制約で「で」+PLACE展開が使えないため、ドメイン固有の場所コンテキストが弱い。

## 改善方向

| 優先度 | 施策 | 期待効果 |
|---|---|---|
| 高 | AM学習データの多様化（VOICEPEAK音声・ピッチシフトデータの追加学習） | 話者・発話スタイル汎化 |
| 高 | 音響特徴量の頑健化（デルタ・デルタデルタ特徴量、VTLN） | 感情変動への耐性・単語弁別向上 |
| 中 | コーパスのさらなる拡張（医療・IT等の新ドメイン） | 未知文カバレッジ向上 |
| 中 | 辞書サイズの最適化（現900語、偽マッチと語彙カバレッジのバランス） | 精度の安定化 |

## 現在の推奨構成

```
AM:   data/work/am_tri_cmn.gob
LM:   data/work/lm_v7.arpa (トライグラム、11,682文から構築)
Dict: data/work/dict_lm_v7.txt (900語)
Flags: -oov-prob -5.0 -lm-weight 23.0 -max-tokens 5000
```
