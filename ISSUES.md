# 現在の課題

## 精度状況

### v7 (トライグラムLM + コーパス拡張辞書)

| テスト条件 | v6 (旧) | v7 (現在) |
|---|---|---|
| 学習データ（873発話、VOICEVOX 18話者） | 820/873 (93.9%) | 818/873 (93.6%) |
| コーパス内文 × VOICEPEAK neutral | 10/10 (100%) | — |
| コーパス内文 × VOICEPEAK 感情50% | 9/10 (90%) | — |
| **コーパス外文 × VOICEPEAK neutral** | **4/10 (40%)** | **8/10 (80%)** |
| コーパス内文 × VOICEPEAK 感情100% | 2/10 (20%) | — |

### v7 で改善した変更点

- **トライグラムLM**: バイグラム(1,290)→トライグラム(8,844) + バイグラム(2,429) + ユニグラム(612)
- **コーパス自動生成** (`cmd/corpusgen`): テンプレートベースで6,637文を生成、全助詞パターンを網羅
- **コーパス対応辞書** (`dictfilter -corpus`): LM語彙を確実に辞書に含める仕組み (649語→724語)
- **LMウェイト調整**: 20.0→23.0

### v7 で解決した失敗例

| 文 | v6 結果 | v7 結果 |
|---|---|---|
| 朝から雨が降る | 朝にが降る | **朝から雨が降る** ✓ |
| 友達と映画を見る | 友達と映画を切る | **友達と映画を見る** ✓ |
| 山まで歩く | 山をまで歩く | **山まで歩く** ✓ |
| 駅から電車に乗る | 駅まで電車に乗る | **駅から電車に乗る** ✓ |
| 部屋で本を読む | — (v6は正解) | **部屋で本を読む** ✓ |

## 残存課題

### 1. 音響的に類似した単語の弁別

AMレベルでの混同が残る。LMで補正しきれないケース。

- 「魚と野菜を買う」→「彼女野菜を買う」（sakana-to / kanojo の音響混同）
- 「猫が窓で寝る」→「猫が窓で帰る」（neru / kaeru の混同）

### 2. 感情・発話スタイル変動への音響モデル頑健性

感情パラメーター100%で2/10まで劣化。MFCC特徴量ベースのHMMはピッチ変動・話速変化・声質変化に弱い。AM学習データはVOICEVOXの平坦な合成音声のみ。

### 3. 学習データの話者・音源多様性の不足

全学習データがVOICEVOX合成音声のみ。話者正規化（VTLN等）やデータ拡張（速度変換・ピッチシフト・ノイズ付加）も未実装。

## 改善方向

| 優先度 | 施策 | 期待効果 |
|---|---|---|
| 高 | AM学習データの多様化（VOICEPEAK音声・ピッチシフトデータの追加学習） | 話者・発話スタイル汎化 |
| 高 | 音響特徴量の頑健化（デルタ・デルタデルタ特徴量、VTLN） | 感情変動への耐性・単語弁別向上 |
| 中 | コーパスのさらなる拡張（より多様な文型・語彙） | 未知文カバレッジ向上 |
| 中 | 辞書サイズの最適化（現724語、偽マッチと語彙カバレッジのバランス） | 精度の安定化 |

## 現在の推奨構成

```
AM:   data/work/am_tri_cmn.gob
LM:   data/work/lm_v7.arpa (トライグラム、7,260文から構築)
Dict: data/work/dict_lm_v7.txt (724語)
Flags: -oov-prob -5.0 -lm-weight 23.0 -max-tokens 5000
```
